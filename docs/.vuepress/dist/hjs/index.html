<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常用js-api | 笔记┉▓</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="rua rua ooo">
    <link rel="preload" href="/doc/assets/css/0.styles.97efef16.css" as="style"><link rel="preload" href="/doc/assets/js/app.1786c276.js" as="script"><link rel="preload" href="/doc/assets/js/2.983a6954.js" as="script"><link rel="preload" href="/doc/assets/js/18.014ef559.js" as="script"><link rel="prefetch" href="/doc/assets/js/10.7bf84da1.js"><link rel="prefetch" href="/doc/assets/js/11.21789933.js"><link rel="prefetch" href="/doc/assets/js/12.fdef0eb1.js"><link rel="prefetch" href="/doc/assets/js/13.ddbc74f6.js"><link rel="prefetch" href="/doc/assets/js/14.a4feca38.js"><link rel="prefetch" href="/doc/assets/js/15.92c09641.js"><link rel="prefetch" href="/doc/assets/js/16.788d7875.js"><link rel="prefetch" href="/doc/assets/js/17.15e0b0d5.js"><link rel="prefetch" href="/doc/assets/js/19.2e3fa230.js"><link rel="prefetch" href="/doc/assets/js/20.498cf0fd.js"><link rel="prefetch" href="/doc/assets/js/21.d6ac17f4.js"><link rel="prefetch" href="/doc/assets/js/22.ffc8a551.js"><link rel="prefetch" href="/doc/assets/js/23.b874b140.js"><link rel="prefetch" href="/doc/assets/js/24.bd5828e3.js"><link rel="prefetch" href="/doc/assets/js/25.a3bdecc8.js"><link rel="prefetch" href="/doc/assets/js/3.33e1d688.js"><link rel="prefetch" href="/doc/assets/js/4.5dbe644f.js"><link rel="prefetch" href="/doc/assets/js/5.a3cac816.js"><link rel="prefetch" href="/doc/assets/js/6.7936f3f2.js"><link rel="prefetch" href="/doc/assets/js/7.1832aa5e.js"><link rel="prefetch" href="/doc/assets/js/8.dff6e169.js"><link rel="prefetch" href="/doc/assets/js/9.7fe59d8d.js">
    <link rel="stylesheet" href="/doc/assets/css/0.styles.97efef16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/doc/" class="home-link router-link-active"><!----> <span class="site-name">笔记┉▓</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/doc/guide/" class="nav-link">
  guide
</a></div><div class="nav-item"><a href="/doc/hjs/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  js关联
</a></div><div class="nav-item"><a href="/doc/hcss/" class="nav-link">
  css关联
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/doc/guide/" class="nav-link">
  guide
</a></div><div class="nav-item"><a href="/doc/hjs/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  js关联
</a></div><div class="nav-item"><a href="/doc/hcss/" class="nav-link">
  css关联
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/hjs/" aria-current="page" class="active sidebar-link">常用js-api</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/hjs/#base64-转换" class="sidebar-link">base64 转换</a></li><li class="sidebar-sub-header"><a href="/doc/hjs/#unicode-转换" class="sidebar-link">Unicode 转换</a></li><li class="sidebar-sub-header"><a href="/doc/hjs/#localstorage" class="sidebar-link">localStorage</a></li><li class="sidebar-sub-header"><a href="/doc/hjs/#includes" class="sidebar-link">includes</a></li><li class="sidebar-sub-header"><a href="/doc/hjs/#模板字符串-自变量" class="sidebar-link">模板字符串 自变量</a></li><li class="sidebar-sub-header"><a href="/doc/hjs/#promise" class="sidebar-link">Promise</a></li><li class="sidebar-sub-header"><a href="/doc/hjs/#generator-迭代器" class="sidebar-link">Generator 迭代器</a></li><li class="sidebar-sub-header"><a href="/doc/hjs/#set" class="sidebar-link">Set</a></li><li class="sidebar-sub-header"><a href="/doc/hjs/#map" class="sidebar-link">Map</a></li></ul></li><li><a href="/doc/hjs/basic/array.html" class="sidebar-link">数组方法</a></li><li><a href="/doc/hjs/basic/string.html" class="sidebar-link">字符串方法</a></li><li><a href="/doc/hjs/basic/algorithm.html" class="sidebar-link">算法</a></li><li><a href="/doc/hjs/basic/depapi.html" class="sidebar-link">深入理解</a></li><li><a href="/doc/hjs/basic/object.html" class="sidebar-link">对象方法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>随记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/hjs/notes/" class="sidebar-link">工作笔记</a></li><li><a href="/doc/hjs/notes/math/formula.html" class="sidebar-link">公式</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="常用js-api"><a href="#常用js-api" class="header-anchor">#</a> 常用js-api</h1> <h2 id="base64-转换"><a href="#base64-转换" class="header-anchor">#</a> base64 转换</h2> <h3 id="btoa-明文转密；atob-密转明文"><a href="#btoa-明文转密；atob-密转明文" class="header-anchor">#</a> btoa 明文转密；atob 密转明文</h3> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">btoa</span><span class="token punctuation">(</span><span class="token string">'shenxiaoyu'</span><span class="token punctuation">)</span>
<span class="token string">&quot;c2hlbnhpYW95dQ==&quot;</span>

window<span class="token punctuation">.</span><span class="token function">atob</span><span class="token punctuation">(</span><span class="token string">&quot;c2hlbnhpYW95dQ==&quot;</span><span class="token punctuation">)</span>
<span class="token string">&quot;shenxiaoyu&quot;</span>
</code></pre></div><h2 id="unicode-转换"><a href="#unicode-转换" class="header-anchor">#</a> Unicode 转换</h2> <h3 id="window-encodeuricomponent"><a href="#window-encodeuricomponent" class="header-anchor">#</a> window.encodeURIComponent</h3> <h3 id="window-decodeuricomponent"><a href="#window-decodeuricomponent" class="header-anchor">#</a> window.decodeURIComponent</h3> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token string">&quot;zg%20%E4%B8%AD%E5%9B%BD&quot;</span>

window<span class="token punctuation">.</span><span class="token function">decodeURIComponent</span><span class="token punctuation">(</span><span class="token string">&quot;zg%20%E4%B8%AD%E5%9B%BD&quot;</span><span class="token punctuation">)</span>
<span class="token string">&quot;zg 中国&quot;</span>
</code></pre></div><h2 id="localstorage"><a href="#localstorage" class="header-anchor">#</a> localStorage</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//写入 3中方法</span>
<span class="token keyword">var</span> storage <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage
storage<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span>
storage<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
storage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">//读取</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>storage<span class="token punctuation">.</span>a<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>storage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>

<span class="token comment">//清空</span>
storage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//删除</span>
storage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</code></pre></div><h2 id="includes"><a href="#includes" class="header-anchor">#</a> includes</h2> <p>判断数组（array) 或字符串（string）是否包含指定的值，如果包含返回true，否则返回false</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">86</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
list<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// true</span>

<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'fanxianfeng'</span>
str<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'fan'</span><span class="token punctuation">)</span>  <span class="token comment">// true</span>
str<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'fanf'</span><span class="token punctuation">)</span>  <span class="token comment">// false</span>
</code></pre></div><h2 id="模板字符串-自变量"><a href="#模板字符串-自变量" class="header-anchor">#</a> 模板字符串 自变量</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">aa</span> <span class="token punctuation">(</span><span class="token parameter">l<span class="token punctuation">,</span> m<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'sxy'</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">12</span>
<span class="token keyword">const</span> city <span class="token operator">=</span> <span class="token string">'bj'</span>
<span class="token keyword">const</span> address <span class="token operator">=</span> <span class="token string">'dxd'</span>
aa<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">i am is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,age is</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,at</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, from</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 输出，第一个参数为字符串集合，剩下参数依次为引用变量</span>
<span class="token punctuation">[</span> <span class="token string">'i am is '</span><span class="token punctuation">,</span> <span class="token string">',age is'</span><span class="token punctuation">,</span> <span class="token string">',at'</span><span class="token punctuation">,</span> <span class="token string">', from'</span><span class="token punctuation">,</span> <span class="token string">''</span> <span class="token punctuation">]</span>
sxy
<span class="token number">12</span>
</code></pre></div><h2 id="promise"><a href="#promise" class="header-anchor">#</a> Promise</h2> <blockquote><p>原理：在Promise原型上有两个方法，resolve和reject，分别是对正常处理和异常处理的回调，且都是异步执行，为的是注册then方法中的回调能先一步放大队列中，方便resolve、reject调用的时候去执行then中回调。
多次promise.then 链式操作，then执行后返回的都是一个Promise的实例，如果在then中有return返回值且有效，就会加入到实例中resolve需要执行回调的队列中，从而把resolve 返回的值放入then返回的实例中。
then 也是异步回调。</p></blockquote> <h5 id="代码实现："><a href="#代码实现：" class="header-anchor">#</a> 代码实现：</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// promise 构造函数</span>
<span class="token keyword">function</span> <span class="token function">promise</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
  that<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'pending'</span> <span class="token comment">// 存储promise的state</span>
  that<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span> <span class="token comment">// 存储promise的value</span>
  that<span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token string">''</span> <span class="token comment">// 存储promise的reason</span>
  that<span class="token punctuation">.</span>onFulfilledCb <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 存储then方法中注册的回调函数（第一个参数）</span>
  that<span class="token punctuation">.</span>onRejectedCb <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 存储then方法中注册的回调函数（第二个参数）</span>

  <span class="token comment">// 2.1</span>
  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将promise的状态从pending更改为fulfilled，并且以value为参数依次调用then方法中注册的回调</span>
<span class="token function">    setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        that<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
        that<span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token comment">// 2.2.2、2.2.6</span>
        that<span class="token punctuation">.</span>onFulfilledCb<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token function">          item</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将promise的状态从pending更改为rejected，并且以reason为参数依次调用then方法中注册的回调</span>
<span class="token function">    setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        that<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'rejected'</span>
        that<span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
        <span class="token comment">// 2.2.3、2.2.6</span>
        that<span class="token punctuation">.</span>onRejectedCb<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token function">          item</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token function">  fn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2.2</span>
promise<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">let</span> promise2

  <span class="token comment">// 2.2.1、2.2.5</span>
  onFulfilled <span class="token operator">=</span> <span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> v
  onRejected <span class="token operator">=</span> <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onRejected</span> <span class="token operator">:</span> <span class="token parameter">r</span> <span class="token operator">=&gt;</span> r

  <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 2.2.7</span>
    <span class="token keyword">return</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      that<span class="token punctuation">.</span>onFulfilledCb<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token function">          promiseResolution</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 2.2.7.2</span>
<span class="token function">          reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      that<span class="token punctuation">.</span>onRejectedCb<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
<span class="token function">          promiseResolution</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 2.2.7.2</span>
<span class="token function">          reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// promise resolution</span>
<span class="token keyword">function</span> <span class="token function">promiseResolution</span><span class="token punctuation">(</span><span class="token parameter">promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> then
  <span class="token keyword">let</span> thenCalled <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token comment">// 2.3.1</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">promise2 <span class="token operator">===</span> x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'promise2 === x is not allowed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 2.3.2</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 2.3.3</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 2.3.3.1</span>
      then <span class="token operator">=</span> x<span class="token punctuation">.</span>then
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2.3.3.2</span>
<span class="token function">        then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 2.3.3.3.3</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>thenCalled<span class="token punctuation">)</span> <span class="token keyword">return</span>
          thenCalled <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token comment">// 2.3.3.3.1</span>
          <span class="token keyword">return</span> <span class="token function">promiseResolution</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">rejectPromise</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 2.3.3.3.3</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>thenCalled<span class="token punctuation">)</span> <span class="token keyword">return</span>
          thenCalled <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token comment">// 2.3.3.3.2</span>
          <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2.3.3.4</span>
<span class="token function">        resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 2.3.3.3.4.1</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>thenCalled<span class="token punctuation">)</span> <span class="token keyword">return</span>
      thenCalled <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token comment">// 2.3.3.2</span>
<span class="token function">      reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 2.3.4</span>
<span class="token function">    resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token function">    setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token function">      resolve</span><span class="token punctuation">(</span><span class="token string">'promise done'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">doSomethingElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// return this.promise2</span>

  <span class="token comment">// return new promise((resolve, reject) =&gt; {</span>
  <span class="token comment">//   setTimeout(() =&gt; {</span>
  <span class="token comment">//     resolve('promise2 done')</span>
  <span class="token comment">//   }, 1000)</span>
  <span class="token comment">// })</span>

  <span class="token comment">// return {</span>
  <span class="token comment">//   then: (resolvePromise, rejectPromise) =&gt; {</span>
  <span class="token comment">//     setTimeout(() =&gt; {</span>
  <span class="token comment">//       resolvePromise(22)</span>
  <span class="token comment">//       rejectPromise(33)</span>
  <span class="token comment">//     })</span>
  <span class="token comment">//   }</span>
  <span class="token comment">// }</span>

  <span class="token comment">// return { test: 4 }</span>

  <span class="token comment">// return function() {</span>
  <span class="token comment">//   console.log('xxxx')</span>
  <span class="token comment">// }</span>

  <span class="token comment">// return 4</span>

  <span class="token comment">// return new Promise((resolve, reject) =&gt; {</span>
  <span class="token comment">//   setTimeout(() =&gt; {</span>
  <span class="token comment">//     reject('ES6 promise')</span>
  <span class="token comment">//   }, 1000)</span>
  <span class="token comment">// })</span>
<span class="token punctuation">}</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>promise2 <span class="token operator">=</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>doSomethingElse<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>promise2<span class="token punctuation">)</span>
</code></pre></div><h4 id="promise-使用-api"><a href="#promise-使用-api" class="header-anchor">#</a> Promise 使用 api</h4> <ul><li>new Promise((res, rej) =&gt; {} )</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
<span class="token function">          res</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token function">          rej</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// rej(xhr.responseText)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>Promise.resolve 、Promise.reject 把一个值转化为promise 对象</p></li> <li><p>Promise.all()   接受多了promise对象, 只要有一个Promise被reject了，那么组成的新的Promise的状态也是reject的</p></li> <li><p>Promise.race()  接受多个promise对象， 只要包裹的的Promise对象中有一个的状态发生了改变，那么组成的这个新的Promise对象的状态就是上面那个率先改变的Promise实例的状态</p></li></ul> <h2 id="generator-迭代器"><a href="#generator-迭代器" class="header-anchor">#</a> Generator 迭代器</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">showWords</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token string">'one'</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token string">'two'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">'three'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> show <span class="token operator">=</span> <span class="token function">showWords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

show<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// {done: false, value: &quot;one&quot;}</span>
show<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// {done: false, value: &quot;two&quot;}</span>
show<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// {done: true, value: &quot;three&quot;}</span>
show<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// {done: true, value: undefined}</span>
</code></pre></div><blockquote><p>yield* 后面跟的也是一个生成器</p></blockquote> <h2 id="set"><a href="#set" class="header-anchor">#</a> Set</h2> <p>不含重复值，可以使用Set去重</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">...</span>a<span class="token punctuation">]</span> <span class="token comment">// [3]</span>

<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">...</span>b<span class="token punctuation">]</span>   <span class="token comment">// [2,3,4,7]</span>

<span class="token keyword">let</span> c <span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">...</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token string">'aabcdee'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
c  <span class="token comment">// 'abcede'</span>
</code></pre></div><h2 id="map"><a href="#map" class="header-anchor">#</a> Map</h2> <p>任何类型都可以作为对象的键值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>p<span class="token operator">:</span> <span class="token string">'Hello World'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">'content'</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token comment">// &quot;content&quot;</span>

m<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token comment">// true</span>
m<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token comment">// true</span>
m<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/doc/hjs/basic/array.html">
        数组方法
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/doc/assets/js/app.1786c276.js" defer></script><script src="/doc/assets/js/2.983a6954.js" defer></script><script src="/doc/assets/js/18.014ef559.js" defer></script>
  </body>
</html>
